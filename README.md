# 保険診断システム

顧客の簡易的な情報から最適な保険を診断・提案するプロフェッショナルなWebアプリケーションです。

## 🎯 プロジェクト概要

ファイナンシャルプランナー（FP）が顧客と対話しながら情報を入力し、リスク分析と最適な保険商品を自動で提案するシステムです。

**金融庁のライフプランシミュレーションを参考にした、根拠のある必要保障額算出機能を搭載しています。**

### 主な特徴

- 💼 **プロフェッショナルなデザイン** - 信頼感のある深いブルーとゴールドのアクセント
- 📊 **5ステップの対話型フォーム** - 顧客が段階的に情報を入力
- 🎯 **金融庁ベースの保障額計算** - ライフプランシミュレーションを参考にした詳細な計算ロジック
- 📈 **視覚的な診断レポート** - Chart.jsで美しいグラフ表現
  - ライフプランシミュレーション（資産推移グラフ）
  - リスク対応度レーダーチャート
  - 保障充足度の円グラフ
  - 計算式の詳細表示
- 🎬 **16:9スライド形式** - プレゼンテーション向けのレポート
- 📱 **完全レスポンシブ** - PC・タブレット・スマートフォン対応
- 🖨️ **PDF保存機能** - ブラウザの印刷機能でPDF化

## 🚀 デモ

**本番環境URL**: https://3000-ideh0ht6l98v4y1f170q2-3844e1b6.sandbox.novita.ai

## ✅ 現在実装済みの機能

### 1. 入力フォーム（5ステップ）

#### Step 1: 基本情報
- 世帯主・配偶者の年齢
- お子様の人数・年齢・教育方針
- 職業形態（会社員/自営業/パート/専業主婦）

#### Step 2: 経済状況
- 夫婦別々の年収（額面）
- **手取り年収の自動計算**（職業形態に応じた控除率）
- 生活費・貯蓄額・住宅ローン
- **夫婦別々の退職金・年金情報**

#### Step 3: 健康・ライフスタイル
- 喫煙状況・健康状態
- **付加給付制度**（大企業/中小企業/国保）
- リスク懸念（精神疾患・長期休職・介護・相続）

#### Step 4: 既契約保険
- 死亡保障額・医療保険・がん保険・就業不能保険

#### Step 5: 確認画面
- 入力内容の一覧表示
- 世帯年収（額面・手取り）の表示

### 2. 診断エンジン

#### 人生の4つのリスク分析

1. **死亡リスク**
   - 遺族年金制度の詳細説明
   - 必要保障額の計算（夫死亡時・妻死亡時）
   - 団信（団体信用生命保険）を考慮

2. **就業不能リスク**
   - 障害年金・傷病手当金の説明
   - 精神疾患・長期休職リスク対応

3. **医療費リスク**
   - 高額療養費制度・付加給付の説明
   - 付加給付に応じた医療保険の必要性評価

4. **3大疾病リスク**
   - がん・急性心筋梗塞・脳卒中の公的保障
   - 長期治療費・収入減への備え

#### 保障充足度分析
- 死亡保障の必要額計算と不足額表示
- 医療保険・がん保険・就業不能保険の加入状況チェック
- ビジュアルな充足度表示（充足/不足/未加入）

### 3. 必要保障額の計算ロジック

**金融庁ライフプランシミュレーションベース:**

```
必要保障額 = 生活費総額 + 教育費 - 遺族年金 - 利用可能資産 - 退職金の一部 - 団信

詳細:
1. 生活費総額（手取りベース）
   - 月々の生活費 × 12 + 年間特別支出
   - 遺族の場合は70-90%で計算（配偶者の収入比率による）
   - 末子が22歳になるまでの期間

2. 教育費（教育方針ごと）
   - 全て公立: 1,000万円
   - 中学から私立: 1,700万円
   - 小学校から私立: 2,000万円
   - 大学時の一人暮らし: +440万円

3. 遺族年金（額面年収ベース）
   - 子どもあり: 基礎年金（100万円）+ 厚生年金（年収の0.6%）
   - 子どもなし: 厚生年金のみ

4. 利用可能資産
   - 貯蓄 + その他資産 - 緊急予備資金（生活費6ヶ月分）

5. 退職金・団信
   - 生存配偶者の退職金の50%を老後資金に充当
   - 死亡配偶者の住宅ローンは団信で完済
```

### 4. 視覚的なレポート（16:9スライド形式）

#### Chart.jsによる6つのグラフ

1. **ライフプランシミュレーション**（折れ線グラフ）
   - 通常ケース（夫婦とも生存）
   - 夫死亡時（妻が生存）
   - 妻死亡時（夫が生存）

2. **リスク対応度レーダーチャート**
   - 死亡リスク、就業不能リスク、医療費リスク、3大疾病リスク
   - 各リスクへの対応度を0〜100%で評価

3. **夫の死亡保障充足度**（円グラフ）
   - 現在の保障額と不足額を表示

4. **妻の死亡保障充足度**（円グラフ）
   - 現在の保障額と不足額を表示

5. **夫死亡時の必要保障額内訳**（棒グラフ）
   - 生活費、教育費、遺族年金、利用可能資産、退職金、団信

6. **妻死亡時の必要保障額内訳**（棒グラフ）
   - 生活費、教育費、遺族年金、利用可能資産、退職金、団信

#### 6つのスライド

1. **サマリースライド** - 4つのリスクの概要
2. **死亡リスク分析** - 詳細な計算内訳とグラフ
3. **就業不能リスク分析** - 公的保障と民間保険
4. **医療費リスク分析** - 高額療養費制度と付加給付
5. **3大疾病リスク分析** - 公的保障と民間保険
6. **おすすめ保険商品** - 優先度別の商品提案

### 5. 保険商品データベース

- 収入保障保険（非喫煙者/喫煙者）
- 就業不能保険（40歳未満/40歳以上）
- 変額保険（運用メイン/保障メイン）
- 医療保険・がん保険
- 介護保険
- 一時払い終身保険（50代以降）

### 6. 商品マッチングエンジン

以下の条件に基づいて最適な商品を自動推奨：
- 喫煙状況、年齢、職業形態
- 資産状況、既契約状況、リスク懸念

## 📁 プロジェクト構造

```
webapp/
├── src/
│   └── index.tsx                 # Honoバックエンド
├── public/
│   └── static/
│       ├── css/
│       │   └── styles.css        # プロフェッショナルなデザインシステム
│       └── js/
│           ├── salary-calculator.js    # 手取り年収計算
│           ├── insurance-data.js       # 保険商品データベース
│           ├── diagnosis-engine.js     # 診断エンジン
│           ├── charts.js               # Chart.js グラフ描画
│           ├── results-display.js      # 結果表示（スライド生成）
│           └── main.js                 # フォーム制御
├── dist/                         # ビルド出力
├── ecosystem.config.cjs          # PM2設定
├── package.json
├── vite.config.ts
├── wrangler.jsonc
└── README.md
```

## 🛠️ 技術スタック

### バックエンド
- **Hono** - 軽量高速なWebフレームワーク
- **Cloudflare Workers** - エッジランタイム
- **TypeScript** - 型安全な開発

### フロントエンド
- **Vanilla JavaScript** - フレームワークレス
- **Chart.js** - データ可視化
- **Font Awesome** - アイコン
- **Google Fonts** - Noto Sans JP + Inter

### デザイン
- **カスタムCSS** - CSS Variables使用
- **レスポンシブデザイン** - モバイルファースト
- **プリント対応** - PDF保存最適化

## 💻 ローカル開発

### 前提条件
- Node.js 18以上
- npm

### セットアップ

```bash
# リポジトリのクローン
git clone <repository-url>
cd webapp

# 依存関係のインストール
npm install

# ビルド
npm run build

# 開発サーバー起動（PM2）
pm2 start ecosystem.config.cjs

# サービス確認
curl http://localhost:3000

# PM2ログ確認
pm2 logs insurance-diagnosis --nostream
```

### 開発用コマンド

```bash
# ポート3000をクリーンアップ
npm run clean-port

# ビルド
npm run build

# サービステスト
npm run test

# Git操作
npm run git:status
npm run git:log
npm run git:commit -- "commit message"
```

## 🎨 デザインシステム

### カラーパレット

- **Primary**: 深いブルー (#1e3a8a) - 信頼感・プロフェッショナル
- **Accent**: ゴールド (#f59e0b) - 高級感・重要性
- **Success**: グリーン (#10b981) - 安心・達成
- **Warning**: オレンジ (#f59e0b) - 注意喚起
- **Danger**: レッド (#ef4444) - 警告・不足

### タイポグラフィ

- **見出し**: Noto Sans JP Bold
- **本文**: Inter Regular / Noto Sans JP Regular
- **数字**: Inter (可読性重視)

## 📊 診断ロジックの特徴

### 1. 手取り年収ベースの計算

- ユーザーから額面年収を収集
- 職業形態に応じて手取り年収を自動計算
- 生活費シミュレーションには手取り年収を使用

### 2. 配偶者の収入比率を考慮

- 妻の収入比率が高いほど、死亡後の生活費削減が少ない
- 収入比率40%以上: 生活費90%
- 収入比率20-30%: 生活費75%
- 収入比率20%未満: 生活費70%

### 3. 団信（団体信用生命保険）を考慮

- 夫死亡時: 夫の住宅ローン残債を必要保障額から控除
- 妻死亡時: 妻の住宅ローン残債を必要保障額から控除

### 4. 退職金・年金を個別管理

- 夫婦別々に退職金・年金を入力
- 生存配偶者の退職金を老後資金に充当

## 🖨️ PDF保存機能

ブラウザの印刷機能を利用したPDF保存：

1. 「PDF保存」ボタンをクリック
2. 印刷プレビュー画面が表示
3. 「PDFとして保存」を選択
4. ファイル名を指定して保存

**印刷時の最適化:**
- 不要な要素（ヘッダー・フッター・ボタン）を非表示
- スライドごとに改ページ
- チャートも含めて印刷可能

## 🚀 今後の拡張案

### 高優先度

1. **データ保存機能**
   - Cloudflare D1での顧客データ管理
   - 診断履歴の蓄積

2. **詳細シミュレーション**
   - キャッシュフロー分析の強化
   - 年金受給額の精密試算

3. **比較機能**
   - 複数商品の詳細比較表
   - 保険料の総支払額比較

### 中優先度

4. **メール送信機能**
   - 診断結果の自動メール送信
   - 顧客への資料送付

5. **管理画面**
   - 顧客一覧管理
   - 診断履歴の統計分析

## 📝 ライセンス

このプロジェクトは教育・業務目的での使用を想定しています。

## 👤 開発者

**GenSpark AI Agent**  
**作成日**: 2025年1月  
**バージョン**: 2.0.0

---

## 🆕 更新履歴

### v2.0.0 (2025-01-30)
- 初回リリース
- プロフェッショナルなデザインシステム実装
- 金融庁ベースの診断エンジン実装
- 16:9スライド形式のレポート実装
- Chart.jsによる6つのグラフ実装
- 4つのリスク分析機能実装
- PDF保存機能実装

---

**お問い合わせ**: このシステムに関するご質問やフィードバックは、開発者までお気軽にご連絡ください。
